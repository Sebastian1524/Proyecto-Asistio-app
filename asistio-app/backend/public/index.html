<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASISTIO - Panel de Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 13px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        button {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: background 0.3s ease;
            width: 100%;
        }

        button:hover {
            background: #764ba2;
        }

        button:active {
            transform: scale(0.98);
        }

        .response {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .success {
            border-left: 4px solid #4caf50;
            background: #f1f8f4;
        }

        .error {
            border-left: 4px solid #f44336;
            background: #fef5f5;
        }

        .info {
            border-left: 4px solid #2196f3;
            background: #f3f9ff;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 13px;
        }

        .qr-container {
            text-align: center;
            margin-top: 10px;
        }

        img[alt="QR"] {
            max-width: 150px;
            border: 2px solid #667eea;
            border-radius: 5px;
            padding: 5px;
            background: white;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: grid;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }

            header {
                padding: 20px;
            }

            .card {
                padding: 20px;
            }
        }

        .token-input {
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .clear-btn {
            background: #999;
            margin-top: 5px;
        }

        .clear-btn:hover {
            background: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì ASISTIO - Sistema de Control de Asistencias</h1>
            <p class="subtitle">Panel de pruebas interactivo de la API</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('auth')">üîê Autenticaci√≥n</button>
            <button class="tab-btn" onclick="switchTab('clases')">üìö Clases</button>
            <button class="tab-btn" onclick="switchTab('asistencia')">‚úÖ Asistencias</button>
            <button class="tab-btn" onclick="switchTab('reportes')">üìä Reportes</button>
            <button class="tab-btn" onclick="switchTab('info')">‚ÑπÔ∏è Info</button>
        </div>

        <!-- TAB: AUTENTICACI√ìN -->
        <div id="auth" class="tab-content active grid">
            <div class="card">
                <h2>üìù Registro</h2>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="regEmail" placeholder="usuario@sena.gov.co">
                </div>
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" id="regNombre" placeholder="Juan">
                </div>
                <div class="form-group">
                    <label>Primer Apellido:</label>
                    <input type="text" id="regAp1" placeholder="P√©rez">
                </div>
                <div class="form-group">
                    <label>Segundo Apellido:</label>
                    <input type="text" id="regAp2" placeholder="Garc√≠a">
                </div>
                <div class="form-group">
                    <label>DNI:</label>
                    <input type="text" id="regDni" placeholder="1234567890">
                </div>
                <div class="form-group">
                    <label>Fecha de Nacimiento:</label>
                    <input type="date" id="regFecha">
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="regPassword" placeholder="M√≠nimo 8 caracteres">
                </div>
                <button onclick="registro()">Registrarse</button>
                <div id="regResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üîë Login</h2>
                <div class="warning">Prueba con:<br><strong>admin@sena.gov.co / admin123</strong></div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" value="admin@sena.gov.co">
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="loginPassword" value="admin123">
                </div>
                <button onclick="login()">Iniciar Sesi√≥n</button>
                <div id="loginResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üë§ Mi Perfil</h2>
                <button onclick="obtenerPerfil()">Obtener Perfil</button>
                <div id="perfilResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üîë Token Actual</h2>
                <div class="form-group">
                    <textarea class="token-input" id="tokenDisplay" readonly rows="4"></textarea>
                </div>
                <button class="clear-btn" onclick="limpiarToken()">Limpiar Token</button>
            </div>
        </div>

        <!-- TAB: CLASES -->
        <div id="clases" class="tab-content grid">
            <div class="card">
                <h2>‚ûï Crear Clase</h2>
                <div class="form-group">
                    <label>Nombre de la Clase:</label>
                    <input type="text" id="nombreClase" placeholder="Ej: Programaci√≥n en Python">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <textarea id="descClase" placeholder="Descripci√≥n de la clase" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>M√°ximo de Estudiantes:</label>
                    <input type="number" id="maxEstudiantes" placeholder="Ej: 30">
                </div>
                <button onclick="crearClase()">Crear Clase</button>
                <div id="crearClaseResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üìã Listar Clases</h2>
                <button onclick="listarClases()">Obtener Clases</button>
                <div id="listarClasesResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üîç Obtener Clase</h2>
                <div class="form-group">
                    <label>ID de la Clase:</label>
                    <input type="number" id="idClase" placeholder="Ej: 1">
                </div>
                <button onclick="obtenerClase()">Buscar</button>
                <div id="obtenerClaseResponse" class="response"></div>
            </div>
        </div>

        <!-- TAB: ASISTENCIAS -->
        <div id="asistencia" class="tab-content grid">
            <div class="card">
                <h2>üìÖ Crear Evento + QR</h2>
                <div class="form-group">
                    <label>ID de la Clase:</label>
                    <input type="number" id="eventoIdClase" placeholder="Ej: 1">
                </div>
                <div class="form-group">
                    <label>Nombre del Evento:</label>
                    <input type="text" id="eventoNombre" placeholder="Ej: Clase de hoy">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <textarea id="eventoDescripcion" placeholder="Opcional" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Fecha del Evento:</label>
                    <input type="date" id="eventoFecha">
                </div>
                <div class="form-group">
                    <label>Hora de Inicio (HH:MM):</label>
                    <input type="text" id="eventoHoraInicio" placeholder="Ej: 08:45">
                </div>
                <div class="form-group">
                    <label>Hora de Fin (opcional HH:MM):</label>
                    <input type="text" id="eventoHoraFin" placeholder="Ej: 09:45">
                </div>
                <button onclick="crearEvento()">Crear Evento</button>
                <div id="crearEventoResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üî≤ Registrar Asistencia por QR</h2>
                <div class="form-group">
                    <label>ID del Evento:</label>
                    <input type="number" id="qrIdEvento" placeholder="Ej: 1">
                </div>
                <div class="form-group">
                    <label>Token √önico (del QR):</label>
                    <input type="text" id="qrToken" placeholder="UUID del evento">
                </div>
                <button onclick="registrarAsistenciaQR()">Registrar Asistencia</button>
                <div id="asistenciaQRResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>‚úèÔ∏è Registrar Asistencia Manual</h2>
                <div class="form-group">
                    <label>ID del Evento:</label>
                    <input type="number" id="manualIdEvento" placeholder="Ej: 1">
                </div>
                <div class="form-group">
                    <label>ID del Usuario:</label>
                    <input type="number" id="manualIdUsuario" placeholder="Ej: 3">
                </div>
                <div class="form-group">
                    <label>¬øPresente?</label>
                    <select id="manualPresente">
                        <option value="true">S√≠, presente</option>
                        <option value="false">No, falta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Justificaci√≥n (opcional):</label>
                    <textarea id="manualJustificacion" placeholder="Raz√≥n de la falta" rows="2"></textarea>
                </div>
                <button onclick="registrarAsistenciaManual()">Registrar</button>
                <div id="asistenciaManualResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üë• Asistencias del Evento</h2>
                <div class="form-group">
                    <label>ID del Evento:</label>
                    <input type="number" id="eventAsistId" placeholder="Ej: 1">
                </div>
                <button onclick="obtenerAsistenciasEvento()">Obtener Asistencias</button>
                <div id="eventAsistResponse" class="response"></div>
            </div>
        </div>

        <!-- TAB: REPORTES -->
        <div id="reportes" class="tab-content grid">
            <div class="card">
                <h2>üìà Mi Asistencia en Clase</h2>
                <div class="form-group">
                    <label>ID de la Clase:</label>
                    <input type="number" id="reportIdClase" placeholder="Ej: 1">
                </div>
                <button onclick="obtenerReporteEstudiante()">Ver Mi Reporte</button>
                <div id="reportEstudianteResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üìä Reporte Completo de Clase</h2>
                <div class="form-group">
                    <label>ID de la Clase:</label>
                    <input type="number" id="reportClaseId" placeholder="Ej: 1">
                </div>
                <button onclick="obtenerReporteClase()">Ver Reporte Completo</button>
                <div id="reportClaseResponse" class="response"></div>
            </div>
        </div>

        <!-- TAB: INFO -->
        <div id="info" class="tab-content grid">
            <div class="card">
                <h2>‚ÑπÔ∏è Informaci√≥n del API</h2>
                <button onclick="obtenerInfo()">Estado del Servidor</button>
                <div id="infoResponse" class="response"></div>
            </div>

            <div class="card">
                <h2>üîç Endpoints Disponibles</h2>
                <div class="response info">
<strong>AUTENTICACI√ìN:</strong>
POST /api/auth/registro
POST /api/auth/login
GET /api/auth/perfil

<strong>CLASES:</strong>
POST /api/clases
GET /api/clases
GET /api/clases/:id
PUT /api/clases/:id
DELETE /api/clases/:id
GET /api/clases/:id/estudiantes

<strong>ASISTENCIAS:</strong>
POST /api/asistencia/evento
GET /api/asistencia/evento/:id_evento/qr
POST /api/asistencia/registrar-qr
POST /api/asistencia/registrar-manual
GET /api/asistencia/evento/:id_evento/asistencias
GET /api/asistencia/reporte/mi-asistencia/:id_clase
GET /api/asistencia/reporte/clase/:id_clase
                </div>
            </div>

            <div class="card">
                <h2>üë• Usuarios de Prueba</h2>
                <div class="response info">
<strong>Administrador:</strong>
Email: admin@sena.gov.co
Contrase√±a: admin123

<strong>Docente:</strong>
Email: docente@sena.gov.co
Contrase√±a: admin123

<strong>Estudiantes:</strong>
Email: estudiante1@sena.gov.co
Email: estudiante2@sena.gov.co
Email: estudiante3@sena.gov.co
Contrase√±a: admin123 (para todos)
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        // Gestionar token
        function obtenerToken() {
            return localStorage.getItem('token');
        }

        function guardarToken(token) {
            localStorage.setItem('token', token);
            actualizarTokenDisplay();
        }

        function limpiarToken() {
            localStorage.removeItem('token');
            actualizarTokenDisplay();
            alert('Token eliminado');
        }

        function actualizarTokenDisplay() {
            const token = obtenerToken();
            document.getElementById('tokenDisplay').value = token ? 
                'Token guardado: ' + token.substring(0, 50) + '...' : 
                'No hay token guardado';
        }

        // Helper para hacer requests
        async function hacerRequest(metodo, endpoint, datos = null) {
            const opciones = {
                method: metodo,
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            const token = obtenerToken();
            if (token) {
                opciones.headers['Authorization'] = `Bearer ${token}`;
            }

            if (datos) {
                opciones.body = JSON.stringify(datos);
            }

            try {
                const respuesta = await fetch(`${API_URL}${endpoint}`, opciones);
                const json = await respuesta.json();
                return { ok: respuesta.ok, status: respuesta.status, data: json };
            } catch (error) {
                return { ok: false, error: error.message };
            }
        }

        function mostrarRespuesta(elementoId, respuesta, tipo = 'info') {
            const elemento = document.getElementById(elementoId);
            elemento.className = `response ${tipo}`;
            if (respuesta.error) {
                elemento.textContent = `‚ùå Error: ${respuesta.error}`;
            } else {
                elemento.textContent = JSON.stringify(respuesta.data, null, 2);
                if (respuesta.data.data && respuesta.data.data.codigo_qr) {
                    const img = document.createElement('div');
                    img.className = 'qr-container';
                    img.innerHTML = `<img src="${respuesta.data.data.codigo_qr}" alt="QR">`;
                    elemento.appendChild(img);
                }
            }
        }

        // AUTENTICACI√ìN
        async function registro() {
            const datos = {
                nombre: document.getElementById('regNombre').value,
                primerApellido: document.getElementById('regAp1').value,
                segundoApellido: document.getElementById('regAp2').value,
                dni: document.getElementById('regDni').value,
                fechaNacimiento: document.getElementById('regFecha').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value
            };

            const respuesta = await hacerRequest('POST', '/api/auth/registro', datos);
            mostrarRespuesta('regResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function login() {
            const datos = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            const respuesta = await hacerRequest('POST', '/api/auth/login', datos);
            if (respuesta.ok && respuesta.data.data.token) {
                guardarToken(respuesta.data.data.token);
                mostrarRespuesta('loginResponse', respuesta, 'success');
                alert('¬°Login exitoso! Token guardado.');
            } else {
                mostrarRespuesta('loginResponse', respuesta, 'error');
            }
        }

        async function obtenerPerfil() {
            const respuesta = await hacerRequest('GET', '/api/auth/perfil');
            mostrarRespuesta('perfilResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        // CLASES
        async function crearClase() {
            const datos = {
                nombre_clase: document.getElementById('nombreClase').value,
                descripcion: document.getElementById('descClase').value,
                max_estudiantes: parseInt(document.getElementById('maxEstudiantes').value) || null
            };

            const respuesta = await hacerRequest('POST', '/api/clases', datos);
            mostrarRespuesta('crearClaseResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function listarClases() {
            const respuesta = await hacerRequest('GET', '/api/clases');
            mostrarRespuesta('listarClasesResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function obtenerClase() {
            const id = document.getElementById('idClase').value;
            const respuesta = await hacerRequest('GET', `/api/clases/${id}`);
            mostrarRespuesta('obtenerClaseResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        // ASISTENCIAS
        async function crearEvento() {
            const datos = {
                id_clase: parseInt(document.getElementById('eventoIdClase').value),
                nombre_evento: document.getElementById('eventoNombre').value,
                descripcion: document.getElementById('eventoDescripcion').value || null,
                fecha_evento: document.getElementById('eventoFecha').value,
                hora_inicio: document.getElementById('eventoHoraInicio').value,
                hora_fin: document.getElementById('eventoHoraFin').value || null
            };

            const respuesta = await hacerRequest('POST', '/api/asistencia/evento', datos);
            mostrarRespuesta('crearEventoResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function registrarAsistenciaQR() {
            const datos = {
                id_evento: parseInt(document.getElementById('qrIdEvento').value),
                token_unico: document.getElementById('qrToken').value
            };

            const respuesta = await hacerRequest('POST', '/api/asistencia/registrar-qr', datos);
            mostrarRespuesta('asistenciaQRResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function registrarAsistenciaManual() {
            const datos = {
                id_evento: parseInt(document.getElementById('manualIdEvento').value),
                id_usuario: parseInt(document.getElementById('manualIdUsuario').value),
                presente: document.getElementById('manualPresente').value === 'true',
                justificacion: document.getElementById('manualJustificacion').value || null
            };

            const respuesta = await hacerRequest('POST', '/api/asistencia/registrar-manual', datos);
            mostrarRespuesta('asistenciaManualResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function obtenerAsistenciasEvento() {
            const id = document.getElementById('eventAsistId').value;
            const respuesta = await hacerRequest('GET', `/api/asistencia/evento/${id}/asistencias`);
            mostrarRespuesta('eventAsistResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        // REPORTES
        async function obtenerReporteEstudiante() {
            const id = document.getElementById('reportIdClase').value;
            const respuesta = await hacerRequest('GET', `/api/asistencia/reporte/mi-asistencia/${id}`);
            mostrarRespuesta('reportEstudianteResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        async function obtenerReporteClase() {
            const id = document.getElementById('reportClaseId').value;
            const respuesta = await hacerRequest('GET', `/api/asistencia/reporte/clase/${id}`);
            mostrarRespuesta('reportClaseResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        // INFO
        async function obtenerInfo() {
            const respuesta = await hacerRequest('GET', '/');
            mostrarRespuesta('infoResponse', respuesta, respuesta.ok ? 'success' : 'error');
        }

        // Tabs
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar el tab seleccionado
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Inicializar
        window.addEventListener('load', () => {
            actualizarTokenDisplay();
            // Establecer fecha de hoy como default
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('eventoFecha').value = hoy;
            document.getElementById('regFecha').value = hoy;
        });
    </script>
</body>
</html>
